(function(){"use strict";var e={322:function(e,t,n){n.d(t,{o:function(){return u}});n(4114);var a=n(144),o=n(2022),r=n(782),s=n(3672),l=n(8976);let i=null;function u(e){if(i)return i;const t=(0,a.KR)(null),n=(0,a.KR)({}),u=(0,a.KR)(!1),c=(0,a.KR)(0);e||(e=(0,r.Pj)());const{addErrorMessage:d}=(0,s.g)(),g=async()=>(t.value||(t.value=await(0,l.W)().getLibraryHandle(),t.value&&await m(t.value)),t.value),v=async()=>{const e=[];if(!t.value)return e;try{for await(const[n,a]of t.value.entries())"directory"===a.kind&&e.push(n)}catch(n){d("An error occurred on comic series listing","",!0),console.error(n)}return e},f=async e=>{const t=[];if(!e)return t;try{for await(const[n,a]of e.entries())if("directory"===a.kind){const e={name:n,type:o.A9};t.push(e)}else{const a=n.slice(n.lastIndexOf("."));if(o.O1.includes(a)){const e={name:n,type:"file"};switch(a){case".pdf":e.type=o.cR;break;case".zip":case".cbz":e.type=o.lM;break;default:e.type="file"}t.push(e)}else console.log("File extension not supported for book: "+e.name+"/"+n,a)}t.sort((e,t)=>e.name.localeCompare(t.name,["fr","en"],{sensitivity:"base"}))}catch(n){d("An error occurred on books listing for comic series "+e.name,"",!0),console.error(n)}return t},p=async e=>{const t=[];if(!e)return t;if(e.__bookType!==o.A9)return t;try{for await(const[n,a]of e.entries())if("file"===a.kind){const a=n.slice(n.lastIndexOf("."));o.Os.includes(a)?t.push(n):console.log("File extension not supported for page: "+e.name+"/"+n)}t.sort((e,t)=>e.localeCompare(t,["fr","en"],{sensitivity:"base"}))}catch(n){d("An error occurred on pages listing for book "+e.name,"",!0),console.error(n)}return t},m=async a=>{u.value=!0,c.value=0,t.value=a,n.value={};const o=await v();for(const e of o){const a=await t.value.getDirectoryHandle(e),o={},r=await f(a);for(const e of r)o[e.name]=e,c.value++;r.length&&(n.value[e]=o)}await e.dispatch("selectLibrary",a.name),await(0,l.W)().setLibraryHandle(a),u.value=!1},b=()=>Object.keys(n.value),k=e=>n.value[e]?Object.keys(n.value[e]):[],y=async(e,a)=>{if(!n.value[e])return null;if(!n.value[e][a])return null;const r=n.value[e][a],s=await t.value.getDirectoryHandle(e);let l={};return l=r.type===o.A9?await s.getDirectoryHandle(a):await s.getFileHandle(a),l.__bookType=r.type,l},h=async(e,t)=>{if(!n.value[e])return[];if(!n.value[e][t])return[];const a=await y(e,t);return await p(a)},w=async(e,t,a)=>{if(!n.value[e])return null;if(!n.value[e][t])return null;const o=await y(e,t);return await o.getFileHandle(a)};return i={libraryHandle:t,loadedBooksCount:c,getLibraryHandle:g,shelf:n,loadLibrary:m,getSeriesList:b,getBooksFromSeries:k,getPagesFromBookDirectory:h,getBookHandle:y,getPageHandle:w,isLoading:u},i}},2022:function(e,t,n){n.d(t,{A9:function(){return l},O1:function(){return o},Os:function(){return r},Y3:function(){return s},cR:function(){return i},kX:function(){return a},lM:function(){return u}});const a="read",o=[".pdf",".zip",".cbz"],r=[".jpg",".jpeg",".png",".bmp",".tiff"],s="keiwen-dans-ma-bulle",l="image_folder",i="pdf",u="zip"},3672:function(e,t,n){n.d(t,{g:function(){return r}});n(4114);var a=n(144);let o=null;function r(){if(o)return o;const e=(0,a.KR)([]),t=t=>{e.value.push(t)},n=(e,n="",a=!1)=>{t({type:"success",message:e,title:n,persistOnce:a})},r=(e,n="",a=!1)=>{t({type:"info",message:e,title:n,persistOnce:a})},s=(e,n="",a=!1)=>{t({type:"warning",message:e,title:n,persistOnce:a})},l=(e,n="",a=!1)=>{t({type:"error",message:e,title:n,persistOnce:a})},i=t=>{e.value.splice(t,1)},u=()=>{const t=[];for(const n of e.value)n.persistOnce&&(n.persistOnce=!1,t.push(n));e.value=t};return o={flashMessages:e,addSuccessMessage:n,addInfoMessage:r,addWarningMessage:s,addErrorMessage:l,clearMessage:i,clearAllMessages:u},o}},3742:function(e,t,n){var a=n(5130),o=n(6768),r=n(4232),s=n(144),l=n(3672),i=n(782);const u={class:"nav-item","aria-label":"Navigate to settings"},c={class:"nav-item"},d={class:"nav-item","aria-label":"Navigate to read page"};var g={__name:"NavBar",setup(e){const t=(0,i.Pj)(),n=(0,o.EW)(()=>t.getters.theme);return(e,t)=>{const a=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("nav",{class:(0,r.C4)("light"===n.value?"menu-light":"menu-dark")},[(0,o.Lk)("div",u,[(0,o.bF)(a,{to:"/settings"},{default:(0,o.k6)(()=>[...t[0]||(t[0]=[(0,o.eW)("Settings",-1)])]),_:1})]),(0,o.Lk)("div",c,[(0,o.bF)(a,{to:"/book","aria-label":"Navigate to book selection"},{default:(0,o.k6)(()=>[...t[1]||(t[1]=[(0,o.eW)("Book",-1)])]),_:1})]),(0,o.Lk)("div",d,[(0,o.bF)(a,{to:"/"},{default:(0,o.k6)(()=>[...t[2]||(t[2]=[(0,o.eW)("Read",-1)])]),_:1})])],2)}}};const v=g;var f=v;const p={class:"message-container"},m=["onClick"];var b={__name:"App",setup(e){const{flashMessages:t,clearMessage:n}=(0,l.g)(),a=(0,i.Pj)(),u=(0,o.EW)(()=>t.value),c=(0,o.EW)(()=>a.getters.theme),d=e=>{switch(e){case"error":return"alert-danger";default:return"alert-"+e}};return(e,t)=>{const a=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.CE)("div",{class:(0,r.C4)("theme-"+c.value)},[(0,o.bF)((0,s.R1)(f)),(0,o.Lk)("div",p,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(u.value,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:(0,r.C4)(["alert",d(e.type)]),onClick:e=>(0,s.R1)(n)(t)},(0,r.v_)(e.message),11,m))),128))]),(0,o.bF)(a,{class:"content"})],2)}}};const k=b;var y=k,h=n(4458);(0,h.k)("service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var w=n(8728),C={__name:"BookInfo",setup(e){const t=(0,i.Pj)(),n=(0,o.EW)(()=>t.getters.comicSeries),a=(0,o.EW)(()=>t.getters.book);return(e,t)=>((0,o.uX)(),(0,o.CE)("div",null,(0,r.v_)(n.value)+": "+(0,r.v_)(a.value),1))}};const P=C;var R=P,L=n(2022),S=n(322);n(4603),n(7566),n(8721);let E=null;function _(e){if(E)return E;e||(e=(0,i.Pj)());const t=(0,S.o)(),{addWarningMessage:n}=(0,l.g)();let a="",o="",r=[];const u=(0,s.KR)(0),c=async()=>{r=[],a=e.getters.comicSeries,o=e.getters.book,r=await t.getPagesFromBookDirectory(a,o),u.value=r.length},d=async e=>r[e]?await t.getPageHandle(a,o,r[e]):null,g=async()=>await d(e.getters.getCurrentPageIndex()),v=async t=>{r=[],a=e.getters.comicSeries,o=e.getters.book,u.value=t},f=()=>{const t=e.getters.getCurrentPageIndex()+1;return 1===t},p=()=>{const t=e.getters.getCurrentPageIndex()+1;return t===u.value},m=async t=>{t<1&&(t=1,n("First page reached")),t>u.value&&(t=u.value,n("Last page reached"));const a=t-1;await e.dispatch("selectPageIndex",a),t===u.value&&await e.dispatch("flagBookCompletion",!0),1===t&&await e.dispatch("flagBookCompletion",!1)};return E={pageCount:u,loadFullBook:v,loadPages:c,getPage:d,getCurrentPage:g,isCurrentPageIsFirst:f,isCurrentPageIsLast:p,goToPage:m},E}var B={__name:"PageInfo",setup(e){const t=(0,i.Pj)(),{pageCount:n,goToPage:l}=_(),u=(0,s.KR)(0);let c;const d=(0,o.EW)(()=>t.getters.getCurrentPageIndex()),g=()=>{clearTimeout(c),c=setTimeout(()=>{v()},800)},v=async()=>{await l(u.value)};return(0,o.wB)(d,async e=>{u.value=e+1}),(0,o.sV)(async()=>{u.value=d.value+1}),(e,t)=>((0,o.uX)(),(0,o.CE)("div",null,[t[1]||(t[1]=(0,o.Lk)("span",{class:"helper"},"Page",-1)),t[2]||(t[2]=(0,o.Lk)("br",null,null,-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),type:"number",pattern:"[0-9]*",inputmode:"numeric",onKeyup:(0,a.jR)(v,["enter"]),onBlur:v,onInput:g},null,544),[[a.Jo,u.value]]),(0,o.eW)(" / "+(0,r.v_)((0,s.R1)(n)),1)]))}};const F=B;var O=F;const I={class:"page-controller"},j=["disabled"],x=["disabled"];var A={__name:"PageController",setup(e){const t=(0,i.Pj)(),{goToPage:n,isCurrentPageIsFirst:a,isCurrentPageIsLast:l}=_(),u=(0,s.KR)(!1),c=(0,s.KR)(!1),d=(0,o.EW)(()=>t.getters.getCurrentPageIndex()),g=(0,o.EW)(()=>t.getters.rightToLeft),v=(0,o.EW)(()=>g.value?"Next":"Previous"),f=(0,o.EW)(()=>g.value?"Previous":"Next"),p=async()=>{g.value?await k():await b()},m=async()=>{g.value?await b():await k()},b=async()=>{await n(d.value)},k=async()=>{await n(d.value+2)};return(0,o.wB)(d,async e=>{u.value=a(),c.value=l()}),(0,o.sV)(async()=>{u.value=a(),c.value=l()}),(e,t)=>((0,o.uX)(),(0,o.CE)("div",I,[(0,o.Lk)("button",{class:"page-controller-zone left-zone btn",onClick:p,disabled:g.value?c.value:u.value},"« "+(0,r.v_)(v.value),9,j),(0,o.bF)((0,s.R1)(O),{class:"info-zone"}),(0,o.Lk)("button",{class:"page-controller-zone right-zone btn",onClick:m,disabled:g.value?u.value:c.value},(0,r.v_)(f.value)+" »",9,x)]))}};const X=A;var W=X;const T={class:"page-reader"},M=["src","alt"];var K={__name:"PageReader",setup(e){const t=(0,i.Pj)(),{loadPages:n,getCurrentPage:a}=_(),{addErrorMessage:r}=(0,l.g)(),u=(0,s.KR)(null),c=(0,o.EW)(()=>t.getters.getCurrentPageIndex()),d=async()=>{const e=await a();if(e)try{const t=await e.getFile();u.value&&URL.revokeObjectURL(u.value),u.value=URL.createObjectURL(t)}catch(t){r("Cannot load image file"),console.error(t)}else r("No page found")};return(0,o.wB)(c,async e=>{await d()}),(0,o.sV)(async()=>{await n(),await d()}),(e,t)=>((0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("div",T,[(0,o.Lk)("img",{src:u.value,alt:"Page "+(c.value+1),width:"100%"},null,8,M),(0,o.bF)((0,s.R1)(W))])]))}},N=n(1241);const H=(0,N.A)(K,[["__scopeId","data-v-6e7a9fe4"]]);var U=H,D=n(9293),V={__name:"PDFReaderManager",props:{isLoaded:{type:Boolean}},emits:["loaded-document"],setup(e,{emit:t}){const n=e,a=t,{activeDocument:r}=(0,D.t1)();return(0,o.wB)(()=>n.isLoaded,e=>{e&&a("loaded-document",r.value)}),(e,t)=>((0,o.uX)(),(0,o.CE)("div"))}};const z=V;var q=z,Q=n(431),Y=n(1706),Z=n(2949),J=n(9384),$=n(959),G=n(8814),ee=n(4473);const te={class:"page-reader",style:{height:"100%"}},ne={key:0,class:"loading-pane"},ae={key:1,class:"pdf-container"},oe={key:0,style:{display:"flex",height:"100%","flex-direction":"column"}};var re={__name:"PDFReader",setup(e){const t=(0,i.Pj)(),{addErrorMessage:n}=(0,l.g)(),{loadFullBook:a}=_(),{engine:r,isLoading:u}=(0,Q.tQ)(),c=(0,s.KR)([]),d=(0,s.KR)(null),g=(0,s.KR)(0),v=(0,o.EW)(()=>t.getters.getCurrentPageIndex()),f=async()=>{const e=await(0,S.o)().getBookHandle(t.getters.comicSeries,t.getters.book);if(e)try{const t=await e.getFile();d.value&&URL.revokeObjectURL(d.value),d.value=URL.createObjectURL(t)}catch(a){n("Cannot load PDF file"),console.error(a)}else n("No book found")},p=()=>{c.value=[(0,Z.Pe)(D.Et,{initialDocuments:[{url:d.value}]}),(0,Z.Pe)(J.qC),(0,Z.Pe)($.PH,{enabled:!1}),(0,Z.Pe)(G.iz),(0,Z.Pe)(ee.xB,{defaultZoomLevel:ee.dm.FitPage})],g.value++},m=e=>{a(e.document.pageCount)};return(0,o.wB)(d,e=>{e&&p()}),(0,o.sV)(async()=>{await f()}),(e,t)=>((0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("div",te,[(0,o.Lk)("div",null,[(0,s.R1)(u)||!(0,s.R1)(r)?((0,o.uX)(),(0,o.CE)("div",ne," Loading PDF Engine... ")):((0,o.uX)(),(0,o.CE)("div",ae,[((0,o.uX)(),(0,o.Wv)((0,s.R1)(Y.U9),{engine:(0,s.R1)(r),plugins:c.value,key:g.value},{default:(0,o.k6)(({activeDocumentId:e})=>[e?((0,o.uX)(),(0,o.Wv)((0,s.R1)(D.N6),{key:0,"document-id":e},{default:(0,o.k6)(({isLoaded:t})=>[(0,o.bF)((0,s.R1)(q),{"is-loaded":t,onLoadedDocument:m},null,8,["is-loaded"]),t?((0,o.uX)(),(0,o.CE)("div",oe,[(0,o.bF)((0,s.R1)(J.LM),{"document-id":e,style:{"background-color":"transparent"}},{default:(0,o.k6)(()=>[((0,o.uX)(),(0,o.Wv)((0,s.R1)(G.er),{key:v.value,"document-id":e,"page-index":v.value},null,8,["document-id","page-index"]))]),_:2},1032,["document-id"])])):(0,o.Q3)("",!0)]),_:2},1032,["document-id"])):(0,o.Q3)("",!0)]),_:1},8,["engine","plugins"]))]))]),(0,o.bF)((0,s.R1)(W))])]))}};const se=(0,N.A)(re,[["__scopeId","data-v-4e6b5a2c"]]);var le=se,ie=(n(4114),n(8111),n(7588),n(4813)),ue=n.n(ie);let ce=null;function de(){if(ce)return ce;const{addErrorMessage:e}=(0,l.g)(),t=(0,s.KR)(null),n=(0,s.KR)(null),a=(0,s.KR)(0);let o=[];const r=async r=>{if(r)try{t.value=null,n.value=r.__bookType,a.value=0,o=[];const s=await r.getFile();switch(n.value){case L.lM:await u(s);break;default:e("Unknown archive type "+n.value)}}catch(s){e("Cannot load archive file"),console.error(s)}else e("No book found")},i=async t=>{if(t<0||t>=a.value)return e("No page found"),null;switch(n.value){case L.lM:return await c(t)}return null},u=async e=>{try{t.value=await ue().loadAsync(e),a.value=0,t.value.forEach((e,t)=>{t.dir||(o.push(t),a.value++)})}catch(n){console.error("Failed to load ZIP archive:",n)}},c=async e=>{if(!o[e])return null;const t=o[e];return await t.async("blob")};return ce={loadArchiveFile:r,loadArchivePage:i,pageCount:a},ce}const ge={class:"page-reader"},ve=["src","alt"];var fe={__name:"ArchiveReader",setup(e){const t=(0,i.Pj)(),{loadFullBook:n}=_(),{loadArchiveFile:a,loadArchivePage:r,pageCount:l}=de(),u=(0,s.KR)(null),c=(0,o.EW)(()=>t.getters.getCurrentPageIndex()),d=async()=>{const e=await(0,S.o)().getBookHandle(t.getters.comicSeries,t.getters.book);await a(e),await n(l.value)},g=async()=>{u.value&&URL.revokeObjectURL(u.value);const e=await r(c.value);e&&(u.value=URL.createObjectURL(e))};return(0,o.wB)(c,async e=>{await g()}),(0,o.sV)(async()=>{await d(),await g()}),(e,t)=>((0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("div",ge,[(0,o.Lk)("img",{src:u.value,alt:"Page "+(c.value+1),width:"100%"},null,8,ve),(0,o.bF)((0,s.R1)(W))])]))}};const pe=fe;var me=pe;const be={key:0},ke={key:1},ye={key:2};var he={__name:"AbstractReader",setup(e){const t=(0,i.Pj)(),{getBookHandle:n}=(0,S.o)(),{addErrorMessage:a}=(0,l.g)(),r=(0,s.KR)(""),u=async()=>{const e=await n(t.getters.comicSeries,t.getters.book);if(!e)return r.value="",void a("No book found");switch(e.__bookType){case L.A9:r.value="pageReader";break;case L.cR:r.value="pdfReader";break;case L.lM:r.value="archiveReader";break}""===r.value&&a("Unable to read book")};return(0,o.sV)(async()=>{u()}),(e,t)=>((0,o.uX)(),(0,o.CE)("div",null,["pageReader"===r.value?((0,o.uX)(),(0,o.CE)("div",be,[(0,o.bF)((0,s.R1)(U))])):(0,o.Q3)("",!0),"pdfReader"===r.value?((0,o.uX)(),(0,o.CE)("div",ke,[(0,o.bF)((0,s.R1)(le))])):(0,o.Q3)("",!0),"archiveReader"===r.value?((0,o.uX)(),(0,o.CE)("div",ye,[(0,o.bF)((0,s.R1)(me))])):(0,o.Q3)("",!0)]))}};const we=he;var Ce=we,Pe={__name:"ReadView",setup(e){return(e,t)=>((0,o.uX)(),(0,o.CE)("div",null,[(0,o.bF)((0,s.R1)(R)),(0,o.bF)((0,s.R1)(Ce))]))}};const Re=Pe;var Le=Re;const Se=["value"];var Ee={__name:"SeriesSelect",setup(e){const t=(0,i.Pj)(),{getSeriesList:n}=(0,S.o)(),l=(0,s.KR)(""),u=(0,o.EW)(()=>n());return(0,o.wB)(l,async e=>{e&&e!==t.getters.comicSeries&&t.dispatch("selectComicSeries",e)}),(0,o.sV)(async()=>{l.value=t.getters.comicSeries}),(e,t)=>((0,o.uX)(),(0,o.CE)("div",null,[t[2]||(t[2]=(0,o.Lk)("label",{for:"seriesSelect"},"Series:",-1)),(0,o.bo)((0,o.Lk)("select",{id:"seriesSelect","onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),class:(0,r.C4)(l.value?"":"empty-select")},[t[1]||(t[1]=(0,o.Lk)("option",{value:"",class:"placeholder",disabled:"",selected:"",hidden:""},"Select series...",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(u.value,e=>((0,o.uX)(),(0,o.CE)("option",{key:e,value:e},(0,r.v_)(e),9,Se))),128))],2),[[a.u1,l.value]])]))}};const _e=Ee;var Be=_e;const Fe=["value"],Oe={key:0};var Ie={__name:"BookSelect",setup(e){const t=(0,i.Pj)(),{getBooksFromSeries:n}=(0,S.o)(),l=(0,w.rd)(),u=(0,s.KR)(""),c=(0,o.EW)(()=>t.getters.comicSeries),d=(0,o.EW)(()=>{const e=n(c.value),a=[];for(let n=0;n<e.length;n++)a.push({name:e[n],completed:t.getters.isBookCompleted(c.value,e[n])});return a});return(0,o.wB)(c,async e=>{e&&(u.value=t.getters.book)}),(0,o.wB)(u,async e=>{e&&e!==t.getters.book&&(await t.dispatch("selectBook",e),l.push({name:"read"}))}),(0,o.sV)(async()=>{u.value=t.getters.book}),(e,t)=>((0,o.uX)(),(0,o.CE)("div",null,[t[2]||(t[2]=(0,o.Lk)("label",{for:"bookSelect"},"Book:",-1)),(0,o.bo)((0,o.Lk)("select",{id:"bookSelect","onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),class:(0,r.C4)(u.value?"":"empty-select")},[t[1]||(t[1]=(0,o.Lk)("option",{value:"",class:"placeholder",disabled:"",selected:"",hidden:""},"Select book...",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(d.value,e=>((0,o.uX)(),(0,o.CE)("option",{key:e.name,value:e.name},[e.completed?((0,o.uX)(),(0,o.CE)("span",Oe,"✓ ")):(0,o.Q3)("",!0),(0,o.eW)((0,r.v_)(e.name),1)],8,Fe))),128))],2),[[a.u1,u.value]])]))}};const je=Ie;var xe=je,Ae={__name:"BookSelectionView",setup(e){return(e,t)=>((0,o.uX)(),(0,o.CE)("div",null,[t[0]||(t[0]=(0,o.Lk)("h1",null,"Book selection",-1)),(0,o.bF)((0,s.R1)(Be),{class:"selection selection-series"}),(0,o.bF)((0,s.R1)(xe),{class:"selection selection-book"})]))}};const Xe=Ae;var We=Xe;const Te=[{path:"/",name:"read",component:Le},{path:"/book",name:"book",component:We},{path:"/settings",name:"settings",component:()=>n.e(594).then(n.bind(n,399))},{path:"/setup",name:"setup",component:()=>n.e(594).then(n.bind(n,7204))}],Me=(0,w.aE)({history:(0,w.Bt)(),routes:Te});var Ke=Me,Ne=n(4664),He=n(8976);const Ue=new Ne.Ay({storage:(0,He.W)().getStorageInstance(),asyncStorage:!0,key:"store"});var De=(0,i.y$)({state:{library:"",comicSeries:"",book:"",shelf:{},rightToLeft:!1,theme:"light"},getters:{comicSeries:e=>e.comicSeries,book:e=>e.book,theme:e=>e.theme,shelf:e=>e.shelf,rightToLeft:e=>e.rightToLeft,getBookOnShelf:(e,t)=>(n,a)=>{if(n||(n=t.comicSeries),!n)return null;if(a||(a=t.book),!a)return null;const o=e.shelf[n];return o?o[a]??null:null},getPageIndex:(e,t)=>(e,n)=>{const a=t.getBookOnShelf(e,n);return a?a.pageIndex??0:0},isBookCompleted:(e,t)=>(e,n)=>{const a=t.getBookOnShelf(e,n);return!!a&&(a.completed??!1)},getCurrentPageIndex:(e,t)=>()=>t.getPageIndex(t.comicSeries,t.book)},mutations:{setLibrary(e,t){e.library=t},setComicSeries(e,t){e.comicSeries=t},setBook(e,t){e.book=t},setPageIndex(e,t){const n=e.shelf[e.comicSeries][e.book];n.pageIndex=t},setBookCompleted(e,t){const n=e.shelf[e.comicSeries][e.book];n.completed=t},setTheme(e,t){e.theme=t},setRightToLeft(e,t){e.rightToLeft=t},addBookOnShelf(e,t){e.shelf[t.comicSeries]||(e.shelf[t.comicSeries]={}),e.shelf[t.comicSeries][t.book]={pageIndex:0,completed:!1}},resetSelection(e){e.comicSeries="",e.book=""}},actions:{selectLibrary({state:e,commit:t},n){n?n!==e.library&&(t("setLibrary",n),t("resetSelection")):(t("setLibrary",""),t("resetSelection"))},selectComicSeries({commit:e},t){e("setBook",""),e("setComicSeries",t)},selectBook({getters:e,dispatch:t,commit:n},a){n("setBook",a);const o=e.getBookOnShelf(e.comicSeries,a);o||t("addBookOnShelf")},selectPageIndex({commit:e},t){e("setPageIndex",t)},flagBookCompletion({commit:e},t){e("setBookCompleted",t)},setTheme({commit:e},t){e("setTheme",t)},setRightToLeft({commit:e},t){e("setRightToLeft",t)},addBookOnShelf({getters:e,commit:t},n,a){return n||(n=e.comicSeries),n?(a||(a=e.book),a?void t("addBookOnShelf",{comicSeries:n,book:a}):null):null}},modules:{},strict:!1,plugins:[Ue.plugin]}),Ve=n(8749);function ze(e,t){const{addWarningMessage:n,clearAllMessages:a}=(0,l.g)(),{getLibraryHandle:o}=(0,S.o)(t);e.beforeEach(async(e,a)=>{await t.restored;const r=await o();if(!r&&"setup"!==e.name)return n("Library is not found, please define main directory","",!0),{name:"setup"};if(r&&"setup"!==e.name){const e=await(0,Ve.B)().hasPermission(r);if(!e)return n("Access to library is no longer granted","",!0),{name:"setup",query:{restore:!0}}}return t.getters.comicSeries&&t.getters.book||"read"!==e.name?void 0:(n("Your current book is not found, please choose one","",!0),{name:"book"})}),e.afterEach(()=>{a()})}ze(Ke,De);const qe=(0,a.Ef)(y).use(De).use(Ke);qe.mount("#app")},8749:function(e,t,n){n.d(t,{B:function(){return s}});var a=n(144),o=n(2022),r=n(3672);function s(){const e=(0,a.KR)(null);let t=!1;const{addErrorMessage:n}=(0,r.g)(),s=async n=>{if(n)return null!==e.value||t||(t=!0,await l(n)),e.value;e.value=!1},l=async a=>{try{let t=await a.queryPermission({mode:o.kX});"granted"!==t&&(t=await a.requestPermission({mode:o.kX}),navigator.storage&&navigator.storage.persist&&await navigator.storage.persist()),e.value="granted"===t}catch(r){n("An error occurred on permission check"),console.error(r),e.value=!1}t=!1};return{permissionStatus:e,hasPermission:s}}},8976:function(e,t,n){n.d(t,{W:function(){return l}});var a=n(144),o=n(1373),r=n.n(o),s=n(2022);function l(){const e=(0,a.KR)(null),t=()=>(e.value||(e.value=r().createInstance({name:s.Y3,storeName:"application-data"})),e.value),n=async()=>{const e=t();return await e.getItem("libraryHandle")},o=async e=>{const n=t();return await n.setItem("libraryHandle",e)};return{getStorageInstance:t,getLibraryHandle:n,setLibraryHandle:o}}}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var r=t[a]={exports:{}};return e[a].call(r.exports,r,r.exports,n),r.exports}n.m=e,function(){var e=[];n.O=function(t,a,o,r){if(!a){var s=1/0;for(c=0;c<e.length;c++){a=e[c][0],o=e[c][1],r=e[c][2];for(var l=!0,i=0;i<a.length;i++)(!1&r||s>=r)&&Object.keys(n.O).every(function(e){return n.O[e](a[i])})?a.splice(i--,1):(l=!1,r<s&&(s=r));if(l){e.splice(c--,1);var u=o();void 0!==u&&(t=u)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[a,o,r]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce(function(t,a){return n.f[a](e,t),t},[]))}}(),function(){n.u=function(e){return"js/"+(594===e?"about":e)+"."+{44:"6b3e2a1d",565:"71edd35f",594:"6962c79f",926:"cf6a953d"}[e]+".js"}}(),function(){n.miniCssF=function(e){return"css/about.9f2fb11d.css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="dans-ma-bulle:";n.l=function(a,o,r,s){if(e[a])e[a].push(o);else{var l,i;if(void 0!==r)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var d=u[c];if(d.getAttribute("src")==a||d.getAttribute("data-webpack")==t+r){l=d;break}}l||(i=!0,l=document.createElement("script"),l.charset="utf-8",n.nc&&l.setAttribute("nonce",n.nc),l.setAttribute("data-webpack",t+r),l.src=a),e[a]=[o];var g=function(t,n){l.onerror=l.onload=null,clearTimeout(v);var o=e[a];if(delete e[a],l.parentNode&&l.parentNode.removeChild(l),o&&o.forEach(function(e){return e(n)}),t)return t(n)},v=setTimeout(g.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=g.bind(null,l.onerror),l.onload=g.bind(null,l.onload),i&&document.head.appendChild(l)}}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p=""}(),function(){if("undefined"!==typeof document){var e=function(e,t,a,o,r){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",n.nc&&(s.nonce=n.nc);var l=function(n){if(s.onerror=s.onload=null,"load"===n.type)o();else{var a=n&&n.type,l=n&&n.target&&n.target.href||t,i=new Error("Loading CSS chunk "+e+" failed.\n("+a+": "+l+")");i.name="ChunkLoadError",i.code="CSS_CHUNK_LOAD_FAILED",i.type=a,i.request=l,s.parentNode&&s.parentNode.removeChild(s),r(i)}};return s.onerror=s.onload=l,s.href=t,a?a.parentNode.insertBefore(s,a.nextSibling):document.head.appendChild(s),s},t=function(e,t){for(var n=document.getElementsByTagName("link"),a=0;a<n.length;a++){var o=n[a],r=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(r===e||r===t))return o}var s=document.getElementsByTagName("style");for(a=0;a<s.length;a++){o=s[a],r=o.getAttribute("data-href");if(r===e||r===t)return o}},a=function(a){return new Promise(function(o,r){var s=n.miniCssF(a),l=n.p+s;if(t(s,l))return o();e(a,l,null,o,r)})},o={524:0};n.f.miniCss=function(e,t){var n={594:1};o[e]?t.push(o[e]):0!==o[e]&&n[e]&&t.push(o[e]=a(e).then(function(){o[e]=0},function(t){throw delete o[e],t}))}}}(),function(){n.b="undefined"!==typeof document&&document.baseURI||self.location.href;var e={524:0};n.f.j=function(t,a){var o=n.o(e,t)?e[t]:void 0;if(0!==o)if(o)a.push(o[2]);else{var r=new Promise(function(n,a){o=e[t]=[n,a]});a.push(o[2]=r);var s=n.p+n.u(t),l=new Error,i=function(a){if(n.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var r=a&&("load"===a.type?"missing":a.type),s=a&&a.target&&a.target.src;l.message="Loading chunk "+t+" failed.\n("+r+": "+s+")",l.name="ChunkLoadError",l.type=r,l.request=s,o[1](l)}};n.l(s,i,"chunk-"+t,t)}},n.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,r,s=a[0],l=a[1],i=a[2],u=0;if(s.some(function(t){return 0!==e[t]})){for(o in l)n.o(l,o)&&(n.m[o]=l[o]);if(i)var c=i(n)}for(t&&t(a);u<s.length;u++)r=s[u],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(c)},a=self["webpackChunkdans_ma_bulle"]=self["webpackChunkdans_ma_bulle"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[504],function(){return n(3742)});a=n.O(a)})();
//# sourceMappingURL=app.948f233f.js.map